# OnlineBookStore_data_analysis
-- This project is a data analysis case study on an Online Book Store dataset. The goal was to explore, clean, and analyze book sales data to uncover insights about customer preferences, pricing trends, inventory management, and sales performance.

-- Create Database
CREATE DATABASE OnlineBookstore;

-- Switch to the database
use OnlineBookstore;

-- Create Tables

CREATE TABLE Books (
    Book_ID SERIAL PRIMARY KEY,
    Title VARCHAR(100),
    Author VARCHAR(100),
    Genre VARCHAR(50),
    Published_Year INT,
    Price NUMERIC(10, 2),
    Stock INT
);

CREATE TABLE Customers (
    Customer_ID SERIAL PRIMARY KEY,
    Name VARCHAR(100),
    Email VARCHAR(100),
    Phone VARCHAR(15),
    City VARCHAR(50),
    Country VARCHAR(150)
);

CREATE TABLE Orders (
    Order_ID SERIAL PRIMARY KEY,
    Customer_ID INT REFERENCES Customers(Customer_ID),
    Book_ID INT REFERENCES Books(Book_ID),
    Order_Date DATE,
    Quantity INT,
    Total_Amount NUMERIC(10, 2)
);

**queries
-- Q1 retrieve all the books from fiction genre
select * from books where genre ='fiction' ;

-- Q2 find books published after the year 1920
select * from books where (published_year) >1950;

-- Q3 list all customers from canada
select name, country from customers where country ='canada';

-- Q4 show orders placed in november 2023
select * from orders where month(order_date)=11 and year(order_date) = 2023;

-- Q5 retrieve the total stocks of books available
select sum(stock)as total_stock from books;

-- Q6 find the details of the most expensive book
select * from books order by price desc limit 1;

-- Q7 show all customers who ordered more than 5 quantity of a book
SELECT 
    customers.Name, orders.Quantity, customers.Customer_ID
FROM
    customers
        JOIN
    orders ON customers.Customer_ID = orders.Customer_ID
WHERE
    orders.Quantity > 5;

-- Q8 retrive all the orders where the total amout exceeds $20
select * from orders where Total_Amount >20;

-- Q9 list all genres available in books table
SELECT DISTINCT
    genre
FROM
    books;

-- Q10 Find the book with lowest stock
SELECT 
    *
FROM
    books
ORDER BY stock ASC
LIMIT 1;

-- Q11 calaculate the total revenue generated by all orders
SELECT 
    SUM(Total_amount) AS total_revenue
FROM
    orders;

-- Q12 retrieve the total number of books sold for each genre
SELECT 
    books.Genre, SUM(orders.Quantity) AS total_books_sold
FROM
    books
        JOIN
    orders ON books.Book_ID = orders.Book_ID
GROUP BY books.Genre;

-- Q13 find the average price of books in the 'fantasy' genre
SELECT 
    AVG(price) avg_price
FROM
    books
WHERE
    genre = 'fantasy';

-- Q14 list customers who have at least 2 orders
SELECT 
    customers.Name,
    Customers.Customer_ID,
    COUNT(orders.Order_ID) AS total_orders
FROM
    customers
        JOIN
    orders ON customers.Customer_ID = orders.Customer_ID
GROUP BY customers.customer_id , customers.Name
HAVING COUNT(orders.Order_ID) >= 2;

-- Q15 find the most frequently ordered book
SELECT 
    b.Title, o.Book_ID, COUNT(o.order_id) AS most_ordered
FROM
    books b
        JOIN
    orders o ON o.Book_ID = b.Book_ID
GROUP BY b.Title , o.Book_ID
ORDER BY most_ordered DESC
LIMIT 1;


-- Q16 show the top 3 expensive books of fantasy genre
SELECT 
    *
FROM
    books
WHERE
    genre = 'fantasy'
ORDER BY Price DESC
LIMIT 3;


-- Q17 retrive the total quantity of books sold by each author
SELECT 
    b.author, SUM(o.quantity) AS total_sold
FROM
    books b
        JOIN
    orders o ON b.Book_ID = o.Book_ID
GROUP BY b.Author
ORDER BY total_sold DESC;


 -- Q18 list the cities where customers who spend over $30 are located
SELECT 
    c.city, o.total_amount
FROM
    customers c
        JOIN
    orders o ON c.Customer_ID = o.Customer_ID
WHERE
    o.Total_Amount > 30;
 
-- Q19 find the customer who spent most on orders
SELECT 
    c.name, SUM(o.Total_Amount) AS total
FROM
    orders o
        JOIN
    customers c ON o.Customer_ID = c.Customer_ID
GROUP BY c.name
ORDER BY total DESC
LIMIT 1;

-- Q20 calculate the stock remaining after fullfilling all orders
SELECT 
    SUM(books.Stock - orders.Quantity) AS remaining_stock
FROM
    books
        JOIN
    orders ON books.Book_ID = orders.Book_ID;

SELECT 
    b.Book_ID,
    b.Title,
    b.Stock,
    COALESCE(SUM(o.Quantity), 0) AS order_quantity,
    b.Stock - COALESCE(SUM(o.Quantity), 0) AS remaining_quantity
FROM
    books b
        LEFT JOIN
    orders o ON b.Book_ID = o.Book_ID
GROUP BY b.Book_ID

